import{w as v,U as x,V as m,j as n,P as S,S as d,B as y,W as j,x as g,H as A,O as F,X as B,Y as w,Z as E}from"./index-B4jAaOIo.js";import{C as P}from"./Close-n0OcuP1k.js";import{u as b}from"./useQuery-C37Jui7W.js";const T=({header:e="Filters",grouped:i=!0,onChange:o,onClose:c,config:u,children:r,...l})=>{const{activeFilters:t,dispatch:s}=v();let a=0;x.Children.forEach(r,p=>{if(x.isValidElement(p)&&p.props.field&&m(t.find(h=>h.field===p.props.field)))return a++});const f=()=>{s({type:"SET_ACTIVE_FILTERS",payload:[]})};return n.jsx(S,{elevation:0,variant:"outlined",...l,children:n.jsxs(d,{spacing:0,children:[e&&n.jsxs(d,{direction:"row",spacing:0,alignItems:"center",sx:{borderBottom:"1px solid",borderBottomColor:"grey.300",paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1},children:[n.jsxs(d,{direction:"row",spacing:2,flex:1,children:[n.jsx(y,{children:e}),a>0&&n.jsx(j,{label:`${a} active`,color:"primary",size:"small"})]}),n.jsx(g,{variant:"outlined",onClick:f,sx:{marginRight:1},children:"Reset"}),n.jsx(A,{onClick:c,children:n.jsx(P,{})})]}),i&&n.jsx(d,{spacing:0,children:r}),!i&&n.jsx(d,{spacing:2,sx:{padding:2},children:r})]})})},k=(e,i)=>{let o=e;return i&&(o=e.filter(c=>JSON.stringify(c).toLowerCase().indexOf(i.toLowerCase())>-1)),o},q=(e,i,o)=>{let c=e;if(e&&i.length>0){const u={};i.forEach(r=>{if(o){const l=o.find(t=>t.field===r.field);u[r.field]=l==null?void 0:l.operator}}),c=e.filter(r=>{let l=!0;return i.forEach(t=>{let s=!1;if(l===!0)switch(u[t.field]){case"contains":{r[t.field].indexOf(t.value)>-1&&(s=!0);break}case"contains-one-of":{Array.isArray(t.value)&&t.value.forEach(a=>{s||(Array.isArray(r[t.field])?r[t.field].indexOf(a)>-1&&(s=!0):r[t.field]===a&&(s=!0))});break}case"equals-one-of":{Array.isArray(t.value)&&t.value.forEach(a=>{s||r[t.field]===a&&(s=!0)});break}case"between-inclusive":{if(Array.isArray(t.value)){const a=t.value[0],f=t.value[1];r[t.field]>=a&&r[t.field]<=f&&(s=!0)}break}case"between-dates-inclusive":{if(typeof r[t.field]=="string"&&Array.isArray(t.value)&&t.value[0]&&t.value[1]){const a=F(r[t.field]);a.isAfter(t.value[0])&&a.isBefore(t.value[1])&&(s=!0)}else s=!0;break}}s||(l=!1)}),l})}return c},L=(e,i,o,c)=>{const u=k(e,c);return q(u,i,o)},I=e=>{let i=e.queryMode==="server"?B(e.activeFilters,e.filterConfigs):new URLSearchParams;e.staticParams&&Object.keys(e.staticParams).forEach(s=>{e.staticParams&&i.append(s,e.staticParams[s].toString())}),e.queryMode==="server"&&(i.append("limit",e.pageSize.toString()),i.append("offset",e.offset.toString()));const o=e.queryMode==="server"?[e.dataSource,{...e.activeFilters,pageSize:e.pageSize,offset:e.offset}]:[e.dataSource],{isPending:c,isFetching:u,isError:r,data:l,error:t}=b({queryKey:o,queryFn:async()=>{const s=i.toString();let a=e.dataSource;return s&&s.length>0&&(a=`${e.dataSource}?${s}`),await E(a)},placeholderData:w});return{isPending:c,isFetching:u,isError:r,data:l,error:t}};export{T as F,L as f,I as u};
